# Парсер биржи KuCoin

Этот проект представляет собой парсер для биржи KuCoin, который собирает исторические данные о торговых парах (криптовалютах) с использованием официального API биржи. Парсер работает в многопроцессорном режиме для эффективного сбора данных.

## Особенности

- Многопроцессорная обработка данных
- Гибкая настройка интервалов сбора данных
- Автоматическая пауза между запросами
- Логирование операций
- Сохранение данных в удобном формате

## Требования

- Python 3.12+
- Зависимости:
  ```bash
  poetry install
  ```

## Настройка

1. **Получение API-ключей**:
   - Зарегистрируйтесь на [KuCoin](https://www.kucoin.com/)
   - Создайте API-ключи в личном кабинете
   - Установите права доступа: **General API** (только чтение)

2. **Настройка конфигурации**:
   Создайте файл `prod.env` в папке settings проекта:
   ```ini

   KUCOIN__API_KEY=ваш_api_ключ
   KUCOIN__API_SECRET=ваш_api_секрет
   KUCOIN__API_PASSPHRASE=ваша_фраза-пароль

   # URL Kucoin parsing
   KUCOIN__DRIVER__URL_PARSING=https://www.kucoin.com/ru/trade/{coin}-USDT
   ```

3. **Список монет**:
   Создайте файл `coins_list.csv` в формате в папке data проекта:
   ```csv
   coins
   BTC
   ETH
   LTC
   ```


## Использование

### Базовый запуск:

```bash
python main.py [временной_интервал] [опции]
```

### Основные параметры:

- временной_интервал - интервал свечей (по умолчанию: 5m)
- Допустимые значения: 5m, 15m, 30m, 1h.

## Опции:

- --pause - пауза между итерациями в минутах (по умолчанию: 60)
- --count - количество собираемых датасетов на монету (-1 - бесконечно) (по умолчанию: 100)
- --mode - режим работы: api или driver (по умолчанию: api)
- --save - сохранять данные (1 - да, 0 - нет) (по умолчанию: 0)
- --save_type - формат сохранения (по умолчанию: raw)
- --clear - очистить предыдущие данные (1 - да, 0 - нет) (по умолчанию: 0)

## Примеры:

```bash
# Сбор данных через API с интервалом 5 минут
python main.py 5m --count=500 --pause=30

# Бесконечный сбор данных через Web Driver
python main.py 15m --mode=driver --count=-1 --pause=45

# Сохранение данных в формате raw
python main.py 1h --save=1 --save_type=raw
```

## Управление

- Для остановки парсера используйте сочетание клавиш Ctrl+C
- Все незавершенные операции будут корректно завершены
- Последние собранные данные сохранятся перед выходом

## Формат сохраняемых данных

Парсер сохраняет данные в CSV-файл со следующими полями:

| Поле      | Описание                                                                | Пример значения         |
|-----------|-------------------------------------------------------------------------|-------------------------|
| `datetime`| Временная метка в формате `YYYY-MM-DD HH:MM:SS` (время аккаунта, UTC+3) | 2025-05-11 14:10:00     |
| `open`    | Цена открытия за указанный временной интервал                           | 0.7997                  |
| `close`   | Цена закрытия за указанный временной интервал                           | 0.7988                  |
| `max`     | Максимальная цена за временной интервал                                 | 0.8003                  |
| `min`     | Минимальная цена за временной интервал                                  | 0.7985                  |
| `volume`  | Объем торгов за временной интервал                                      | 32978.622967            |

### Особенности формата:
1. Временные метки записываются с 5-минутным интервалом (пример: 14:00, 14:05, 14:10)
2. Все ценовые значения сохраняются с точностью до 4 знаков после десятичной точки
3. Объемы отображаются с точностью до 6 знаков после десятичной точки
4. Данные сортируются по убыванию времени (свежие записи в начале файла)
5. Кодировка файла: UTF-8
6. Разделитель полей: запятая (`,`)

## Логирование

- Все операции записываются в файл app.log
- Реальный вывод дублируется в консоль
- Уровень логирования настраивается через переменные окружения

## Хранение данных

- Поддерживаются различные форматы сохранения
- По умолчанию данные хранятся в памяти
- Для постоянного хранения используйте опцию --save

## Оптимизация

- Рекомендуемая пауза между запросами: 30+ минут
- Режим API лучше подходит для исторических данных
- Режим Driver обеспечивает актуальные данные в реальном времени

## Лицензия

Проект распространяется под лицензией MIT.
